import jwt from "jsonwebtoken";
import { CustomException } from "../classes/custom_exception.js";

/**
 * Genera un token JWT.
 * @param {string} jwtSecret - Clave secreta para firmar (HS256).
 * @param {object} payload - Claims a incluir en el token.
 * @param {object} [options] - Opciones de jsonwebtoken (expiresIn, issuer, audience, subject, etc.).
 * @returns {string} token firmado
 */
export function generateToken({ jwtSecret, payload = {}, options = {}, expiresIn, issuer, audience }) {
    if (!jwtSecret || typeof jwtSecret !== "string" || !jwtSecret.trim()) {
        throw new CustomException({ title: "Error de generación de token", message: "generateToken: jwtSecret inválido" });
    }

    const defaultOptions = {
        expiresIn: expiresIn || "2h",
        issuer: issuer,
        audience: audience,
    };

    return jwt.sign(payload, jwtSecret, { ...defaultOptions, ...options });
}
