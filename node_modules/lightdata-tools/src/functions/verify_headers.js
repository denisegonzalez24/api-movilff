// verify_headers.js
import { CustomException } from "../classes/custom_exception.js";
import { Status } from "../classes/status.js";
import { getHeaders } from "./get_headers.js";

export function verifyHeaders({ req, requiredHeaders = [] }) {
    if (requiredHeaders.length === 0) {
        return;
    }
    const headers = getHeaders(req);

    const isMissing = (val) =>
        val == null || (typeof val === "string" && val.trim() === "");

    const missingHeaders = requiredHeaders.filter((name) => {
        const fromObj = headers[name];
        const fromReq = req.header(name);
        const v = fromObj ?? fromReq;
        return isMissing(typeof v === "string" ? v.trim() : v);
    });

    if (missingHeaders.length > 0) {
        throw new CustomException({
            title: `Missing headers: ${missingHeaders.join(", ")}`,
            message: `The following headers are required: ${missingHeaders.join(", ")}`,
            status: Status.badRequest,
        });
    }

    return headers;
}
